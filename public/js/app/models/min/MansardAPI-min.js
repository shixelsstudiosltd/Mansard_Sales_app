define(["jquery","underscore","backbone","views/SearchResultView"],function($,n,e,a){var s=e.Model.extend({initialize:function(){n.bindAll(this)},login:function(n){var e=this;$(".login-button").html('<i class="fa fa-spinner fa-spin"></i>'),$(".login-button").attr("disabled","disabled"),$.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/MobileLogin/atu?CustomerNo=0&passcode=0&Username="+n.username+"&Password="+n.password,type:"POST",success:function(n){n.username&&n.isFirstTimeLogin?($(".login-form-form").hide(),$(".login-agent-code").show()):n.username&&!n.isFirstTimeLogin?e.isFA(n.AgentCode,n.username):($(".login-error").html('<div class="alert alert-warning" role="alert">Incorrect Username and/or Password!</div>'),$(".login-button").html("Login"),$(".login-button").removeAttr("disabled"))}})},logout:function(){localStorage.removeItem("session"),window.location.hash="",Mansard.isLoggedIn=!1},search:function(n){var e=this,s=null;$(".search-results-container").html('<div class="search-load"><i class="fa fa-spinner fa-spin"></i> Searching...</div>'),$(".results-num").html("-"),s=Mansard.isFA?"https://online.mansardinsurance.com/MansardSalesWebApi/api/Contacts/getContactByName?contactname="+n:"https://online.mansardinsurance.com/MansardSalesWebApi/api/Customer/Post_GetCustomerByName/"+n,$.ajax({url:s,success:function(n){for(var s=0;s<n.length;s++){var t=n[s],r=new a({result:t});e.renderResult(r,n.length)}$(".results-num").html(n.length)}})},isFA:function(n,e){var a=this;$.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/Agent/Get?agentCode="+n+"&username="+e,type:"GET",success:function(n){n.NeedsSalesDiary?(n.username=e,a.session(JSON.stringify(n)),Mansard.appRouter.navigate("dashboard",{trigger:!0}),location.reload()):(n.username=e,a.session(JSON.stringify(n)),Mansard.appRouter.navigate("products",{trigger:!0}),location.reload())}})},quote:function(n,e){var a=null,s=null;return"motor"===n?a="https://online.mansardinsurance.com/MansardSalesWebApi/api/Quote/jComputePremium_Motor":"life"===n&&(a="https://online.mansardinsurance.com/MansardSalesWebApi/api/Riders/Post_GetLifeRiders"),$.ajax({url:a,type:"POST",data:e,async:!1,success:function(n){s=n}}),s},products:function(n){var e=null,a=null;return"motor"===n?e="https://online.mansardinsurance.com/MansardSalesWebApi/api/Products/GetProducts_Motor":"life"===n&&(e="https://online.mansardinsurance.com/MansardSalesWebApi/api/Products/GetProducts_Life"),$.ajax({url:e,type:"GET",async:!1,success:function(n){a=n}}),a},save_contact:function(n){$.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/Contacts/Post_SaveContactInfo",type:"post",data:n,success:function(n){$(".contact-add-form")[0].reset(),$(".submit-contact-button").removeAttr("disabled"),$(".submit-contact-button").html("Save Contact"),$(".contact-message").html(n.Message)}})},customer:function(n){var e=null;return $.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/Customer/getCustomerPolicies?customerNo="+n.customerNo+"&email="+n.email,async:!1,success:function(n){e=n}}),e},session:function(n){var e="MA_"+this.generateToken(70),a={agent:JSON.stringify(n),session_token:e};localStorage.setItem("session",JSON.stringify(a))},token:function(){var n="0123456789abcdefghijklmnopqurstuvwxyzABCDEFGHIJKLMNOPQURSTUVWXYZ";return n.substr(this.getRandomNumber(62),1)},getRandomNumber:function(n){return Math.floor(Math.random()*n)},generateToken:function(n){for(var e="",a=0;n>a;a++)e+=this.token();return e},discovery_quesions:function(){var n=null;return $.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/Discovery/Post_GetAllDiscoveryInterviewQuestions",type:"POST",async:!1,success:function(e){n=e}}),n},discovery_options:function(n){var e=null;return $.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/Discovery/Post_GetOptions?questionID="+n,type:"POST",async:!1,success:function(n){e=n}}),e},discovery_results:function(n){var e=null;return $.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/Discovery/Post_GetInferenceBySectionScoreAndSectionID?sectionId="+n.sectionId+"&sectionScore="+n.sectionScore,type:"POST",async:!1,success:function(n){e=n}}),e},renderResult:function(n){$(".search-results-container").prepend(n.render().el)},kyc_dropdowns:function(n){var e=null,a=null;return"business"===n?a="getBusinessType":"transaction"===n?a="getTransactionStatus":"religion"===n?a="getReligion":"job"===n?a="GetJobTitles":"employ"===n?a="GetEmploymentTypes":"profession"===n?a="GetProfession":"salary"===n&&(a="getAnnualSalary"),$.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/Shared/"+a,type:"GET",async:!1,success:function(n){e=n}}),e},kyc:function(n){$(".submit-ind").html('<i class="fa fa-spinner fa-spin"></i>'),$(".submit-ind").attr("disabled","disabled"),$(".submit-corp").html('<i class="fa fa-spinner fa-spin"></i>'),$(".submit-corp").attr("disabled","disabled"),$.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/KYC/Post_SaveKycInfo",type:"POST",data:n,success:function(n){$(".submit-ind").html("Submit"),$(".submit-ind").removeAttr("disabled"),$(".submit-corp").html("Submit"),$(".submit-corp").removeAttr("disabled"),$(".status-kyc").html(n.IsSuccessful?"KYC Submitted Successfully!":"An Error Occured, Please Try again!")}})},save_policy:function(n,e){var a=null;"motor"===n?a="https://online.mansardinsurance.com/MansardSalesWebApi/api/Motor/PostMotor":"life"===n&&(a=""),$.ajax({url:a,type:"POST",data:e,success:function(n){console.log(n)}})},policy_dropdowns:function(n,e){var a=null,s=null,t=null;return"plates"===n?s="https://online.mansardinsurance.com/MansardSalesWebApi/api/Motor/GetVehiclePlateColours":"uses"===n?s="https://online.mansardinsurance.com/MansardSalesWebApi/api/Motor/GetVehicleUses":"places"===n?s="https://online.mansardinsurance.com/MansardSalesWebApi/api/Motor/GetVehicleRegPlaces":"manYear"===n?s="https://online.mansardinsurance.com/MansardSalesWebApi/api/shared/GetVehicleManufacturinYear":"payFreq"===n?s="https://online.mansardinsurance.com/MansardSalesWebApi/api/shared/getPaymentFrequencies":"insPeriod"===n?(t="https://online.mansardinsurance.com/MansardSalesWebApi/api/Shared/GetInsurancePeriod/?productCode="+e,s=t):"payPeriod"===n&&(t="https://online.mansardinsurance.com/MansardSalesWebApi/api/Shared/GetPaymentPeriod/?productCode="+e,s=t),$.ajax({url:s,type:"GET",async:!1,success:function(n){a=n}}),a},convert:function(n){$.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/Contacts/Post_ConvertToLead",data:n,type:"POST",success:function(n){console.log(n)}})},sectors:function(n){var e=null,a=null;return"main"===n?a="https://online.mansardinsurance.com/MansardSalesWebApi/api/ESMS/GetAllSectors":"sub"===n&&(a="https://online.mansardinsurance.com/MansardSalesWebApi/api/ESMS/GetAllSubSectors"),$.ajax({url:a,type:"GET",async:!1,success:function(n){e=n}}),e},sectorChange:function(n){var e=null;return $.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/ESMS/Post_CheckIfSectorHasChanged?sectorId="+n.sectorId+"&mCustRowID="+n.mCustRowID,type:"POST",async:!1,success:function(n){e=n,console.log(e)}}),e},parseQueryString:function(e){var a={};return e&&n.each(n.map(decodeURI(e).split(/&/g),function(n,e){var a=n.split("="),s={};if(a.length>=1){var t=null;2==a.length&&(t=a[1]),s[a[0]]=t}return s}),function(e){n.extend(a,e)}),a},esms:function(n){var e=null;return $.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/ESMS/GetSectionQuestions?sectionID="+n+"&isCorporate=True",type:"GET",async:!1,success:function(n){e=n}}),e},dashboard:function(n){var e={};return $.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/Agent/GetTotalLifePremiumPaid?agentCode="+n,type:"GET",async:!1,success:function(n){e.life=n}}),$.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/Agent/GetTotalNonLifePremiumPaid?agentCode="+n,type:"GET",async:!1,success:function(n){e.nonlife=n}}),$.ajax({url:"https://online.mansardinsurance.com/MansardSalesWebApi/api/Agent/GetTotalClaimsPaid?agentCode="+n,type:"GET",async:!1,success:function(n){e.claims=n}}),e},digits:function(n){return n.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}});return s});